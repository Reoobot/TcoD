<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calcular Velocidad con Neumáticos y Margen de Error</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input {
      width: 150px;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #rangoVelocidad1,
    #rangoVelocidad2 {
      margin-top: 20px;
    }
    #diferenciaVelocidad {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Calcular Velocidad con Neumáticos y Margen de Error</h2>
  
  <label for="w">W (impulsos por kilómetro):</label>
  <input type="text" id="w" value="7654"><br>
  
  <label for="l">L (longitud del pulso en mm):</label>
  <input type="text" id="l" value="3316"><br>
  
  <label for="velocidadObjetivo">Velocidad Objetivo (km/h):</label>
  <input type="text" id="velocidadObjetivo" value="90"><br>

  <label for="profundidadDibujo">Profundidad del dibujo (mm):</label>
  <input type="text" id="profundidadDibujo" value="14"><br>

  <label for="ancho">Ancho del neumático (mm):</label>
  <input type="text" id="ancho" value="315"><br>

  <label for="aspecto">Relación de aspecto:</label>
  <input type="text" id="aspecto" value="80"><br>

  <label for="diametro">Diámetro del rin (pulgadas):</label>
  <input type="text" id="diametro" value="22.5"><br>

  <button onclick="calcularVelocidad('rangoVelocidad1')">Calcular Velocidad Configuración 1</button>
  <div id="rangoVelocidad1"></div>

  <button onclick="calcularVelocidad('rangoVelocidad2')">Calcular Velocidad Configuración 2</button>
  <div id="rangoVelocidad2"></div>

  <hr>

  <h2>Comparación de Velocidades</h2>
  <button onclick="redireccionarResultados()">Comparar Velocidades</button>
  
  <div id="diferenciaVelocidad"></div>
  <div><a href="index.html">REGRESAR</a></div>

  <script>
    let velocidadCalculada1 = 0;
    let velocidadCalculada2 = 0;

    function calcularVelocidad(idResultado) {
      // Obtener los valores desde los inputs
      let w = parseFloat(document.getElementById('w').value);
      let l = parseFloat(document.getElementById('l').value);
      let velocidadObjetivo = parseFloat(document.getElementById('velocidadObjetivo').value);
      let profundidadDibujo = parseFloat(document.getElementById('profundidadDibujo').value);
      let ancho = parseFloat(document.getElementById('ancho').value);
      let aspecto = parseFloat(document.getElementById('aspecto').value);
      let diametro = parseFloat(document.getElementById('diametro').value);

      // Validar datos numéricos
      if (isNaN(w) || isNaN(l) || isNaN(velocidadObjetivo) || isNaN(profundidadDibujo) ||
          isNaN(ancho) || isNaN(aspecto) || isNaN(diametro)) {
        alert('Por favor ingrese valores numéricos válidos en todos los campos.');
        return;
      }

      // Calcular factor de corrección por profundidad del dibujo
      let factorCorreccion = calcularFactorCorreccion(profundidadDibujo);

      // Calcular velocidad con W y L dados, ajustada por la profundidad del dibujo y características del neumático
      let velocidadCalculada = calcularVelocidadConWL(w, l * factorCorreccion, ancho, aspecto, diametro);

      // Actualizar las variables de velocidad calculada según la configuración
      if (idResultado === 'rangoVelocidad1') {
        velocidadCalculada1 = parseFloat(velocidadCalculada);
        localStorage.setItem('configuracion1', JSON.stringify({
          w: w,
          l: l,
          velocidadObjetivo: velocidadObjetivo,
          profundidadDibujo: profundidadDibujo,
          ancho: ancho,
          aspecto: aspecto,
          diametro: diametro,
          velocidadCalculada: velocidadCalculada1
        }));
      } else if (idResultado === 'rangoVelocidad2') {
        velocidadCalculada2 = parseFloat(velocidadCalculada);
        localStorage.setItem('configuracion2', JSON.stringify({
          w: w,
          l: l,
          velocidadObjetivo: velocidadObjetivo,
          profundidadDibujo: profundidadDibujo,
          ancho: ancho,
          aspecto: aspecto,
          diametro: diametro,
          velocidadCalculada: velocidadCalculada2
        }));
      }

      // Mostrar los resultados en el HTML
      mostrarResultados(w, l, velocidadObjetivo, profundidadDibujo, ancho, aspecto, diametro, velocidadCalculada, idResultado);
    }

    function mostrarResultados(w, l, velocidadObjetivo, profundidadDibujo, ancho, aspecto, diametro, velocidad, idResultado) {
      // Calcular margen de error del ±2%
      let margenError2 = 0.02;
      let velocidadMinima2 = velocidadObjetivo * (1 - margenError2);
      let velocidadMaxima2 = velocidadObjetivo * (1 + margenError2);

      // Mostrar los resultados en el HTML
      let resultadosElement = document.getElementById(idResultado);
      resultadosElement.innerHTML = `
        <h3>Resultados de la Configuración ${idResultado.slice(-1)}</h3>
        <p>W: ${w.toFixed(2)}</p>
        <p>L: ${l.toFixed(2)}</p>
        <p>Velocidad Objetivo: ${velocidadObjetivo} km/h</p>
        <p>Profundidad del dibujo: ${profundidadDibujo} mm</p>
        <p>Medida del neumático: ${ancho} / ${aspecto} R${diametro.toFixed(2)}</p>
        <p>Velocidad Calculada: ${parseFloat(velocidad).toFixed(2)} km/h</p>
        <p>Margen de error del ±2%: ${velocidadMinima2.toFixed(2)} - ${velocidadMaxima2.toFixed(2)} km/h</p>
      `;
    }

    function calcularFactorCorreccion(profundidadDibujo) {
      // Supongamos una relación lineal: a menor profundidad, menor longitud del pulso (L)
      // Aquí podrías ajustar una fórmula específica según datos empíricos o normativas
      // Por simplicidad, vamos a utilizar una regla de tres simple basada en una profundidad de dibujo de referencia
      let profundidadReferencia = 14; // Profundidad de dibujo de referencia en mm
      let factor = profundidadDibujo / profundidadReferencia;
      return factor;
    }

    function calcularVelocidadConWL(w, l, ancho, aspecto, diametro) {
      // Supongamos que la velocidad base para w=7654 y l=3316 es 90 km/h
      let velocidadBase = 90; // Velocidad base para simplificación
      let factorW = 7654 / w;
      let factorL = l / 3316;
      let factorNeumatico = calcularFactorNeumatico(ancho, aspecto, diametro);
      let velocidad = velocidadBase * factorW * factorL * factorNeumatico;
      return velocidad.toFixed(2); // Redondear a dos decimales
    }

    function calcularFactorNeumatico(ancho, aspecto, diametro) {
      // Supongamos una fórmula simple para calcular un factor de corrección basado en el ancho, relación de aspecto y diámetro del neumático
      // Puedes ajustar esta fórmula según las especificaciones o normativas específicas
      let factor = 1 + (ancho - 315) / 315 + (aspecto - 80) / 80 + (diametro - 22.5) / 22.5;
      return factor;
    }

    function redireccionarResultados() {
      if (velocidadCalculada1 === 0 || velocidadCalculada2 === 0) {
        alert('Por favor calcule las velocidades para ambas configuraciones antes de comparar.');
        return;
      }
      window.location.href = 'resultados.html';
    }
  </script>
</body>
</html>
